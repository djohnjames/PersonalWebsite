<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Smart Thermostat</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicons/favicon-32x32.png" rel="icon" sizes="32x32">
  <link href="assets/img/favicons/favicon-16x16.png" rel="icon" sizes="16x16">
  <link href="assets/img/favicons/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
  <link rel="manifest" href="assets/img/favicons/site.webmanifest">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Font Awesome Kit Code -->
  <script src="https://kit.fontawesome.com/f24fddb5a2.js" crossorigin="anonymous"></script>

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YC3L1Q5S9R"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YC3L1Q5S9R');
  </script>

</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="detail fixed-top">
    <div class="container d-flex align-items-center justify-content-between">

      <h1 class="logo"><a href="index.html">Dylan's Portfolio</a></h1>
      <!-- Uncomment below when I finish logo-->
      <!-- <a href="index.html" class="logo"><img src="assets/img/logo.png" alt="" class="img-fluid"></a> -->

      <nav id="navbar" class="navbar">
        <ul>
          <li><a class="nav-link scrollto active" href="index.html">Home</a></li>
          <li><a class="nav-link scrollto" href="index.html#about">About</a></li>
          <li><a class="nav-link scrollto" href="index.html#skills">Skills</a></li>
          <li class="dropdown"><a href="index.html#projects"><span>Projects</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="ST-details.html">Smart Home Thermostat</a></li>
              <li><a href="#">RBA Program</a></li>
              <li><a href="#">TTPMS</a></li>
              <li><a href="#">HorseBit</a></li>
              <li><a href="#">FSAE MATLAB</a></li>
              <li><a href="#">Web Dev.</a></li>
            </ul>
          </li>

          <li><a class="nav-link scrollto " href="#blog">Blog</a></li>
          <li><a class="nav-link scrollto" href="#contact">Contact</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->

  <div class="intro intro-single route bg-image" style="background-image: url(assets/img/heroo-bg.jpg)">
    <!-- <div class="overlay-mf"></div> -->
    <!-- <div class="intro-content display-table">
      <div class="table-cell">
        <div class="container"> -->
          <!-- <h2 class="intro-title mb-4">Portfolio Details</h2> -->
          <!-- <ol class="breadcrumb d-flex justify-content-center">
            <li class="breadcrumb-item">
              <a href="#">Home</a>
            </li>
            <li class="breadcrumb-item active">Portfolio Details</li>
          </ol> -->
        <!-- </div>
      </div>
    </div> -->
  </div>

  <main id="main">

    <!-- ======= Portfolio Details Section ======= -->
    <section id="portfolio-details" class="portfolio-details">
      <div class="container">
        <div class="row gy-4">
          <div class="col-lg-8">
            <div class="portfolio-details-slider swiper-container">
              <div class="swiper-wrapper align-items-center">

                <div class="swiper-slide">
                  <img src="assets/img/enclosure.jpg" alt="">
                </div>

                <!-- <div class="swiper-slide">
                  <img src="assets/img/enclosure1.jpg" alt="">
                </div> -->

                <div class="swiper-slide">
                  <img src="assets/img/nodeMCU.jpg" alt="">
                </div>

                <div class="swiper-slide">
                  <img src="assets/img/soldered_board.jpg" alt="">
                </div>

                <div class="swiper-slide">
                  <img src="assets/img/breadboard_testing.jpg" alt="">
                </div>

              </div>
              <div class="swiper-pagination"></div>
            </div>
          </div>

          <div class="col-lg-4">
            <div class="portfolio-description">
              <h2>Smart Home Thermostat</h2>
              <p>
                After moving houses and no longer having a Nest Thermostat, I wanted to try my hand at creating an
                equivalent product. There are still many features I am working on adding, but the current version
                has been operating reliably for several months.
                
              </p>
            </div>

            <div class="portfolio-info">
              <h3>Quick Specs</h3>
              <ul>
                <li><strong>Furnace Type</strong>: Two-wire Systems</li>
                <li><strong>Microprocessor</strong>: ESP8266</li>
                <li><strong>Network Protocol</strong>: MQTT</li>
                <li><strong>App Compatibility</strong>: Android (iOS coming soon)</li>
                <li><strong>Code Repository</strong>: <a href="https://github.com/djohnjames"><i class="bi bi-github" style="font-size: 1rem;"></i></a></li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="row gy-4">
          <div class="col-lg-12">
            <div class="portfolio-info">
              <h3>Enclosure</h3>
              <div class="row gy-4 justify-content-evenly">
                <div class="col-lg-5">
                  <model-viewer style="width:100%; height:300px; margin: auto;" src="assets/glb/FrontPlate2.0.glb" auto-rotate="" camera-controls="" ar-status="not-presenting"> </model-viewer>
                  <p>The above model is the front plate of the enclosure. The front panel is curved for aesthetics and features an engraved graphic. Behind the front panel is a slot
                  that holds a standard 8,000-10,000mAh battery pack. The side rails have grooves that allow the enclosure to slide over the furnace wires and into a resting position
                  on the back plate.</p>
                </div>
                <div class="col-lg-5">
                  <model-viewer style="width:100%; height:300px; margin: auto;" src="assets/glb/BackPlate.glb" auto-rotate="" camera-controls="" ar-status="not-presenting"> </model-viewer>
                  <p>This piece of the enclosure screws onto the wall. It was designed to use the screw holes of the old thermostat and to use a minimal amount of material to reduce
                    cost and printing time. It features a widened screw slot for the bottom screw, which allows the plate to be leveled before the lower screw is locked into position.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--Have an update post at the bottom about ssh onto the raspberry pie to set a static ip and set up a broker on it-->
        <div class="row gy-4">
          <div class="col-lg-12">
            <div class="portfolio-info">
              <h3>Design Requirements</h3>

                <div class="row gy-4">
                  <div class="col-lg-6">
                    <div class="row">
                      <div class="col-lg-1">
                        <i class="bi bi-check2-circle fa-2x"></i>
                      </div>
                      <div class="col-lg-10">
                        <h4>Air temperature accuracy of <span>&#177;</span>0.5<span>&#8451;</span> within set temperature.</h4>
                        <p>The first iteration used a simple analog temperature sensor that worked by outputting a voltage proportional to the temperature reading. While the analog temperature
                          sensor was easy to implement for a first attempt, it was not ideal for a number of reasons. Firstly, the accuracy of an analog sensor could not be
                          guaranteed without a calibration procedure. A digital sensor would not require this additional calibration process. Secondly, the board the ESP8266
                          is mounted on only has one pin capable of an analog reading. I wanted to keep this pin free for future features such as being able to read the battery 
                          level remaining in the battery pack. Finally, the resolution of readings from an analog sensor is limited by the 10-bit ADC onboard the NodeMCU. While
                           the resolution is high enough for the intended application, I preferred to not have my design limited this way.
                          <br><br>
                          The digital sensor I choose is the LMT01 by Texas Instruments. The LMT01 was selected due to its low cost, 2-pin through-hole or SMD packaging, and 
                          because it met the electrical specifications needed to work with the rest of the system. The LMT01 communicates with a pulse-count interface. I use a
                          3904 BJT to pull the pulse's up to 3.3V or down to near 0V for a cleaner signal for the ESP8266 to read.</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="row">
                      <div class = "col-lg-1">
                        <i class="bi bi-check2-circle fa-2x"></i>
                      </div>
                      <div class = "col-lg-10">
                        <h4>Ability to interface with thermostat using a personal computer.</h4>
                        <p>This is a key requirement of the design, as I wanted to have the
                          convenience of controlling the thermostat from all of my devices. Central to implementing this functionality, was the selection of the ESP8266 
                          microprocessor used in the design. The ESP8266 has an integrated 2.4GHz Wi-Fi radio with a built in antenna. This device was chosen for it's low cost,
                          wide availability of software development kit's (SDK) with extensive documentation, and power-saving capabilities. Currently the ESP8266 is mounted on a
                          NodeMCU development board, and future development will have a purpose built PCB for reducing costs and improved power savings. Additionally, work will 
                          be done to look into migrating to the next gen ESP32 chips.
                          <br><br>
                          To communicate with the ESP8266 the MQTT protocol is used. The MQTT is a standard messaging protocol for the Internet of Things (IoT) originally developed
                          in the upstream oil and gas industry. This protocol is well suited for my design because it is extremely lightweight, scales well, and has numerous features
                          that will be valuable for future development. I am experimenting using a public MQTT broker, as well as my own running on a personal computer. Messages are currently
                          sent with QoS 0 through well organized topics.
    
                          Eventually, I hope to have a back-end system that will control the MQTT broker. This system would be responsible for storing historical temperature and user data in an SQL database
                          as well as performing analytics to help users reduce their energy use for heating their homes.</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row gy-4">
                  <div class="col-lg-6">
                    <div class="row">
                      <div class="col-lg-1">
                        <i class="bi bi-check2-circle fa-2x"></i>
                      </div>
                      <div class="col-lg-10">
                        <h4>Ability to override heating control wirelessly and physically.</h4>
                        <p>This functionality is important for testing and fail safe
                          purposes. Physical override is implemented with a simple slide switch that closes the furnace control circuit. Wireless override is implemented
                          with a MQTT channel that can be toggled to take precedence over all other processes (such as the scheduled and user set temperature) to force the
                          furnace into ON or OFF operation. When designing the device, I wanted to ensure the proper fail safe's were in place in the event of a hardware, 
                          software, or power supply failure.</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="row">
                      <div class = "col-lg-1">
                        <i class="bi bi-circle fa-2x"></i>
                      </div>
                      <div class = "col-lg-10">
                        <h4>Be able to switch a furnace having a control signal of up to x.xA and 30VAC. </h4>
                        <p> A two-wire 
                          furnace system is controlled by opening or closing a control signal. When the furnace's control
                          signal is closed the furnace detects flow of current and begins heating. By opening the control circuit
                          the furnace ceases heating. The microprocessor needed to be able to open and close this control circuit. This
                          functionality was implemented using a solid state relay (SSR). 
                          <br><br>
                          A SSR was chosen for the job for its reliability and fast switching speed. The control current for the SSR sources from the
                          microprocessor and is set with a resistor. The model I choose is designed to use a DC control signal to switch an AC circuit.</p>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="row gy-4">
                  <div class="col-lg-6">
                    <div class="row">
                      <div class="col-lg-1">
                        <i class="bi bi-check2-circle fa-2x"></i>
                      </div>
                      <div class="col-lg-10">
                        <h4>Do not require an external power source.</h4>
                        <p>This feature will be implemented by leaching current 
                          off of the furnace's control wire. To complete this requirement the AC control signal will need to be converted to regulated 3.3V
                          DC for the microprocessor. The first iteration will only leach current when the furnace is set to ON. This way, current will already
                          be flowing through the furnace control wire and leaching current will have no affect on the operation of the furnace. However, when
                          the furnace is not on, an external power source such as a battery will be required (which will require periodic charging).
                          <br><br>
                          The second iteration will not require the user to have to periodically charge the battery. Instead, the battery pack will be 
                          slowly recharged by leaching a small amount of current off the control signal as required. Testing will be required to determine the
                          maximum about of current that can be leached for charging without indirectly turning on the furnace. This method to complete this requirement 
                          assumes this maximum current value is non zero.</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="row">
                      <div class = "col-lg-1">
                        <i class="bi bi-circle fa-2x"></i>
                      </div>
                      <div class = "col-lg-10">
                        <h4>Have a battery life of 30 days.</h4>
                        <p>The ESP8266 microprocessor draws a maximum of 170mA but typically uses 70mA during
                          normal operation. Additionally, the microprocessor has functionality to implement a variety of sleep modes to reduce power consumption. I utilize
                          the "deep-sleep" functionality which reduces current draw to a reported 20<span>&#181;</span>A. The deep-sleep functionality works by stopping
                          all non-essential processes and simply operating a timer (set by the user). Once the timer expires, the D0 pin is set to high. By connecting to D0
                          pin to the RST pin, the device can be woken into a normal operating mode. Eventually, the user interface for the thermostat will have the 
                          functionality for the user to be able to set the sleep time to give users more control over the device. Since the majority of the power is drawn 
                          by the Wi-Fi radio, future software versions will be optimized to reduce Wi-Fi use.</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row gy-4">
                  <div class="col-lg-6">
                    <div class="row">
                      <div class="col-lg-1">
                        <i class="bi bi-circle fa-2x"></i>
                      </div>
                      <div class="col-lg-10">
                        <h4>Ability to interface with thermostat using a device with iOS/Android.</h4>
                        <p>Coming Soon!</p>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="row">
                      <div class = "col-lg-1">
                        <i class="bi bi-circle fa-2x"></i>
                      </div>
                      <div class = "col-lg-10">
                        <h4>Ability to interface with thermostat using Google Home and Alexa.</h4>
                        <p>Coming Soon!</p>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Should maybe grouo by hardware/software -->
                <!-- data analysis, energy savings, home/away feature, add thermostat to account
                -->
            </div>
          </div>
        </div>

        <div class="row gy-4">
          <div class="col-lg-12">
            <div class="portfolio-info">
              <h3>Updates and Progress</h3>
              <div class="row-lg-12">
                <strong>LAMP Server on the Raspberry Pi - May 20, 2021</strong>
                <br>
                <p>I have installed a LAMP server on the Pi that will act as the back-end for the thermostat. Apache is used to server requests over HTTP/S. A MySQL
                  database was installed and is currently being used to log data from the thermostat and will be used as the backend database moving forward. PHPMyAdmin
                  was also installed and I played around with some of the features of this tool. <strong>Next I would like to build some sort of API that can be used by smart home
                  devices (Google Home/Amazon Alexa), mobile apps (iOS/Android), and websites to view the temperature data, set schedules, and set new temperatures.</strong>
                  <br><br>
                  I also wrote a Python program that interfaces with the MQTT broker. The script receives the following data HERE every 
                  XX secs from the thermostat and writes it into a MySQL database for processing to be handeled by different back-end program., 
                  and controls the thermostat by sending ON or OFF signals. Incase the connection breaks(communication error), the 
                  ESP also has the capability to control the thermostat to meet the set temperature onboard. 
                  <br><br>

                  Finally I started to play around with the Flask framework in Python for building a website for the thermostat. The stack for this project is already
                  bigger than I thought it would get and there is still lots to do!
                </p>
              </div>
              <div class="row-lg-12">
                <strong>Power Saving Firmware Release - May 12, 2021</strong>
                <br>
                <p>I finally finished a new version of firmware to run the ESP8266 microcontroller. Here are some of the features I use to improve power efficiency:
                </p>
                <ul>
                  <li>Not using a DHCP connection and using a static IP instead. This allows the ESP8266 to connect to WiFi quicker.</li>
                  <li>Stopping the default functionality of writing connection details to flash memory. This saves 1.2 seconds.</li>
                  <li>Storing the channel number (BSSID) so the ESP8266 does not need to scan for a network. This is done by saving the data in a struct
                    and saving the data into RTC memory. Then on connection it checks if the data is correct and attempts to connect. If after 100 tries
                    with no connection it will not use the stored BSSID data and scan. If after 600 tries the chip will go back into deep sleep.</li>
                  <li>Only turning WiFi radio when I need to. This is just long enough to transmit current temperature data and listen for any incoming messages.</li>
                  <li>When waking from deep sleep, I bypassed the default setting and keep the WiFi radio shut down until I need it to be on.</li>
                </ul>
                <p>Unfortunately I did not benchmark the power use before the update to verify my new design, however moving forward power usage and battery
                  life will be tracked for future improvements.</p>
              </div>
              <div class="row-lg-12">
                <strong>Started up the Raspberry Pi - May 6, 2021</strong>
                <br>
                <p>Today I set up a Raspberry Pi to act as the MQTT broker for the thermostat. First, I used ssh to connect to the Pi and
                  give it a static IP so that my routers DHCP does not change it. This ensures all devices on the MQTT network always find
                  the broker. Then I downloaded a MQTT broker onto the Pi and configured it to start up automatically on boot. After some testing
                  with a MQTT client and the thermostat I verified it was working correctly. Next steps are to set up a SQL server on the Pi to log 
                  data and to set up a python flask powered webserver for displaying the data.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div> <!-- End of Container-->
    </section><!-- End Portfolio Details Section -->
  </main><!-- End #main -->

  <div id="preloader"></div>
  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/purecounter/purecounter.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/typed.js/typed.min.js"></script>
  
  <!-- 3D Model Viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>